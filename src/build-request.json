{
  "kind": "build_request",
  "title": "Fix admin allowlist loading to grant access to authenticated user",
  "priority": "high",
  "requirements": [
    {
      "id": "REQ-38",
      "text": "Fix the backend getAdminAllowlist() query method to ensure it returns the complete list of admin Principals without throwing errors or exceptions, and add robust error handling so it always returns a valid array even if AccessControl state is uninitialized.",
      "target": "backend",
      "source": {
        "messageIds": [
          "msg-user-fix-deployment",
          "msg-user-get-access",
          "msg-user-go",
          "msg-user-build-fast"
        ],
        "quotes": [
          "Unable to load admin allowlist. Please contact support."
        ]
      },
      "acceptanceCriteria": [
        "getAdminAllowlist() returns an array of Principal strings without throwing exceptions",
        "The method handles uninitialized or corrupt AccessControl state gracefully",
        "Returns at least the hardcoded super-admin Principal in the array"
      ]
    },
    {
      "id": "REQ-39",
      "text": "Verify and ensure that Principal 'jwxbf-7t3mq-z2mw2-kglpm-vjiqq-yfjhx-fxojo-5k7kl-i6gx5-idwc6-qqe' is hardcoded as a permanent super-admin in the AccessControl module initialization, guaranteeing it is always present in the allowlist regardless of stored state or upgrade scenarios.",
      "target": "backend",
      "source": {
        "messageIds": [
          "msg-user-get-access",
          "msg-user-go"
        ],
        "quotes": [
          "Your Principal ID: jwxbf-7t3mq-z2mw2-kglpm-vjiqq-yfjhx-fxojo-5k7kl-i6gx5-idwc6-qqe"
        ]
      },
      "acceptanceCriteria": [
        "The super-admin Principal is initialized in AccessControl on every canister deployment",
        "AccessControl.isAdmin() returns true for this Principal",
        "The admin survives canister upgrades and redeployments"
      ]
    },
    {
      "id": "REQ-40",
      "text": "Add defensive error handling in the AccessDeniedScreen component's admin allowlist fetch logic to prevent UI errors when getAdminAllowlist() fails, ensuring the user's Principal ID remains visible and copyable even if the allowlist cannot be loaded.",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-user-fix-deployment",
          "msg-user-build-fast"
        ],
        "quotes": [
          "Unable to load admin allowlist. Please contact support."
        ]
      },
      "acceptanceCriteria": [
        "AccessDeniedScreen displays user Principal even when allowlist fetch fails",
        "Copy-to-clipboard functionality works regardless of allowlist load state",
        "Error message clearly indicates allowlist loading failure without breaking the UI"
      ]
    },
    {
      "id": "REQ-41",
      "text": "Add backend logging or debug output during AccessControl initialization and getAdminAllowlist() execution to verify that the hardcoded super-admin is present and that the allowlist query executes successfully.",
      "target": "backend",
      "source": {
        "messageIds": [
          "msg-user-fix-deployment",
          "msg-user-go"
        ]
      },
      "acceptanceCriteria": [
        "AccessControl logs successful initialization with admin count",
        "getAdminAllowlist() logs when invoked and returns successfully",
        "Logs confirm super-admin Principal is present in the allowlist"
      ]
    }
  ],
  "constraints": [
    "Maintain single-actor architecture with all logic in backend/main.mo",
    "Do not modify immutable frontend paths: frontend/src/hooks/useInternetIdentity.ts, frontend/src/hooks/useInternetIdentity.tsx, frontend/src/hooks/useActor.ts, frontend/src/main.tsx, frontend/src/components/ui",
    "Preserve all existing admin Principals during any AccessControl state modifications",
    "Ensure AccessControl state persists correctly across canister upgrades"
  ],
  "nonGoals": [
    "Implementing additional admin management features beyond allowlist loading fixes",
    "Changing the authentication flow or Internet Identity integration",
    "Modifying the UI design or layout of the AccessDeniedScreen beyond error handling improvements",
    "Adding new admin Principals beyond the hardcoded super-admin"
  ],
  "imageRequirements": {
    "required": [],
    "edits": []
  }
}